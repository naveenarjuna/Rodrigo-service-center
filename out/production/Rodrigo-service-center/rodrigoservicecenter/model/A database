-- Create Department table
CREATE TABLE Department (
    departmentId INT PRIMARY KEY,
    departmentName VARCHAR(100),
    location VARCHAR(100)
);

-- Create Employee table
CREATE TABLE Employee (
    employeeId INT PRIMARY KEY,
    nic INT,
    name VARCHAR(100),
    roleName VARCHAR(100),
    phone INT,
    email VARCHAR(100),
    address VARCHAR(200),
    dateOfJoining DATE,
    dateOfBirth DATE,
    workOutlet VARCHAR(100),
    departmentId INT,
    FOREIGN KEY (departmentId) REFERENCES Department(departmentId)
);

CREATE TABLE Customers (
    customerId INT PRIMARY KEY,
    username VARCHAR(100),
    password VARCHAR(100),
    contactNumber INT,
    email VARCHAR(100),
    address VARCHAR(200),
    registrationDate DATE
);

CREATE TABLE Vehicle (
    vehicleId VARCHAR(50) PRIMARY KEY,
    customerId INT,
    model VARCHAR(100),
    year INT,
    fuelType VARCHAR(50),
    lastServicedDate DATE,
    mileage INT,
    FOREIGN KEY (customerId) REFERENCES Customers(customerId)
);

CREATE TABLE Appointment (
    appointmentId INT PRIMARY KEY,
    customerId INT,
    vehicleId VARCHAR(50),
    status VARCHAR(50),
    serviceName VARCHAR(100),
    description Varchar(200),
    scheduledDate DATE,
    scheduledTime TIME,
    FOREIGN KEY (customerId) REFERENCES Customers(customerId),
    FOREIGN KEY (vehicleId) REFERENCES Vehicle(vehicleId)
);

CREATE TABLE Service (
    serviceId INT PRIMARY KEY,
    serviceName VARCHAR(100),
    description Varchar(200),
    estimatedDuration TIME,
    vehicleCompatibility VARCHAR(100),
    price INT
);

CREATE TABLE ServiceRecord (
    recordId INT PRIMARY KEY,
    appointmentId INT,
    vehicleId VARCHAR(50),
    customerId INT,
    serviceId INT,
    description Varchar(200),
    dateOfService DATE,
    totalCost Double,
    FOREIGN KEY (appointmentId) REFERENCES Appointment(appointmentId),
    FOREIGN KEY (vehicleId) REFERENCES Vehicle(vehicleId),
    FOREIGN KEY (customerId) REFERENCES Customers(customerId),
    FOREIGN KEY (serviceId) REFERENCES Service(serviceId)
);

CREATE TABLE ServiceOutlet (
    outletId INT PRIMARY KEY,
    outletName VARCHAR(100),
    location VARCHAR(100),
    contactNumber INT,
    email VARCHAR(100)
);

CREATE TABLE Supplier (
    supplierId INT PRIMARY KEY,
    supplierName VARCHAR(100),
    address VARCHAR(200)
    contactNumber INT,
    email VARCHAR(100),
);

CREATE TABLE Product (
    productId INT PRIMARY KEY,
    productName VARCHAR(100),
    category VARCHAR(100),
    vehicleCompatibility VARCHAR(100),
    brand VARCHAR(100),
    description Varchar(200),
    unitPrice Double,
    supplierId INT,
    FOREIGN KEY (supplierId) REFERENCES Supplier(supplierId)
);

-- Step 1: Add outletId column
ALTER TABLE Product
ADD outletId INT;

-- Step 2: Add foreign key constraint
ALTER TABLE Product
ADD CONSTRAINT fk_product_outlet
FOREIGN KEY (outletId) REFERENCES ServiceOutlet(outletId);

-- Step 1: Add outletId column
ALTER TABLE Appointment
ADD outletId INT;

-- Step 2: Add foreign key constraint
ALTER TABLE Appointment
ADD CONSTRAINT fk_appointment_outlet
FOREIGN KEY (outletId) REFERENCES ServiceOutlet(outletId);

CREATE TABLE invoice_service (
	serviceInvoiceId INT PRIMARY KEY AUTO_INCREMENT,
    invoiceId INT,
    serviceId INT,
    FOREIGN KEY (invoiceId) REFERENCES invoice(invoiceId),
    FOREIGN KEY (serviceId) REFERENCES service(serviceId)
);

CREATE TABLE invoice_product (
	productInvoiceId INT PRIMARY KEY AUTO_INCREMENT,
    invoiceId INT,
    productId INT,
    quantity INT DEFAULT 1,
    FOREIGN KEY (invoiceId) REFERENCES invoice(invoiceId),
    FOREIGN KEY (productId) REFERENCES product(productId)
);


CREATE TABLE payment (
    paymentId INT PRIMARY KEY AUTO_INCREMENT,
    customerId INT,
    invoiceId INT,
    totalAmount INT,
    paymentDate DATE,
    paymentMethod VARCHAR(50),
    paymentStatus VARCHAR(50),
    FOREIGN KEY (customerId) REFERENCES customer(customerId),
    FOREIGN KEY (invoiceId) REFERENCES invoice(invoiceId)
);

CREATE TABLE invoice (
    invoiceId INT PRIMARY KEY AUTO_INCREMENT,
    customerId INT,
    issueDate DATE,
    dueDate DATE,
    totalAmount INT,
    paymentStatus VARCHAR(50),
    FOREIGN KEY (customerId) REFERENCES customer(customerId)
);

ALTER TABLE appointment
-- Remove old column
DROP COLUMN serviceName,

-- Add new column for serviceId
ADD COLUMN serviceId INT DEFAULT NULL,

-- Add foreign key constraint to service table
ADD CONSTRAINT fk_appointment_service
FOREIGN KEY (serviceId) REFERENCES service(serviceId);

ALTER TABLE employee
-- Rename workOutlet to outletId and change its type to INT
CHANGE COLUMN workOutlet outletId INT,

-- Add foreign key constraint to serviceoutlet
ADD CONSTRAINT fk_employee_outlet
FOREIGN KEY (outletId) REFERENCES serviceoutlet(outletId);


